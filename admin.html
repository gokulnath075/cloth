<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel — PREMIUM.</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* ===== ADMIN PANEL STYLES ===== */
        body.admin-body {
            background: var(--grey-100);
            margin: 0;
            overflow: hidden
        }

        .admin-layout {
            display: grid;
            grid-template-columns: 260px 1fr;
            height: 100vh
        }

        .admin-sidebar {
            background: var(--black);
            color: var(--white);
            display: flex;
            flex-direction: column;
            padding: 0;
            overflow-y: auto
        }

        .admin-sidebar .logo {
            padding: 24px 24px 32px;
            font-family: var(--font-display);
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: 2px;
            border-bottom: 1px solid var(--grey-800);
            display: flex;
            align-items: center;
            gap: 8px
        }

        .admin-sidebar .logo span {
            color: var(--gold)
        }

        .admin-sidebar .logo small {
            font-family: var(--font-body);
            font-size: .6rem;
            background: var(--gold);
            color: var(--black);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase
        }

        .admin-nav {
            flex: 1;
            padding: 16px 0
        }

        .admin-nav a {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 24px;
            color: var(--grey-400);
            font-size: .85rem;
            font-weight: 500;
            transition: var(--transition);
            cursor: pointer;
            border-left: 3px solid transparent
        }

        .admin-nav a:hover {
            color: var(--white);
            background: rgba(255, 255, 255, .05)
        }

        .admin-nav a.active {
            color: var(--gold);
            background: rgba(201, 168, 76, .08);
            border-left-color: var(--gold)
        }

        .admin-nav a .material-symbols-outlined {
            font-size: 1.2rem
        }

        .admin-nav .nav-divider {
            height: 1px;
            background: var(--grey-800);
            margin: 12px 24px
        }

        .admin-sidebar .store-link {
            padding: 16px 24px;
            border-top: 1px solid var(--grey-800);
            font-size: .8rem
        }

        .admin-sidebar .store-link a {
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 8px
        }

        .admin-main {
            overflow-y: auto;
            padding: 32px;
            background: var(--grey-100)
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px
        }

        .admin-header h1 {
            font-size: 1.8rem;
            font-family: var(--font-display)
        }

        .admin-header .actions {
            display: flex;
            gap: 12px
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--radius-md);
            padding: 24px;
            border: 1px solid var(--grey-200);
            transition: var(--transition)
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px)
        }

        .stat-card .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            font-size: 1.3rem
        }

        .stat-card .stat-icon.blue {
            background: #e3f2fd;
            color: #1976d2
        }

        .stat-card .stat-icon.gold {
            background: #fff8e1;
            color: var(--gold-dark)
        }

        .stat-card .stat-icon.green {
            background: #e8f5e9;
            color: #388e3c
        }

        .stat-card .stat-icon.red {
            background: #fce4ec;
            color: #c62828
        }

        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: var(--font-display);
            line-height: 1
        }

        .stat-card .stat-label {
            font-size: .8rem;
            color: var(--grey-400);
            margin-top: 6px;
            text-transform: uppercase;
            letter-spacing: .5px
        }

        /* Table */
        .admin-card {
            background: var(--white);
            border-radius: var(--radius-md);
            border: 1px solid var(--grey-200);
            overflow: hidden;
            margin-bottom: 24px
        }

        .admin-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--grey-200)
        }

        .admin-card-header h2 {
            font-size: 1.1rem;
            font-family: var(--font-display)
        }

        .admin-card-header .search-box {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--grey-50);
            border: 1px solid var(--grey-200);
            border-radius: var(--radius-sm);
            padding: 0 12px
        }

        .admin-card-header .search-box input {
            border: none;
            background: none;
            padding: 10px 8px;
            font-size: .85rem;
            width: 220px;
            outline: none
        }

        .admin-card-header .search-box .material-symbols-outlined {
            color: var(--grey-400);
            font-size: 1.1rem
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse
        }

        .admin-table th {
            text-align: left;
            padding: 12px 16px;
            font-size: .7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--grey-400);
            font-weight: 600;
            background: var(--grey-50);
            border-bottom: 1px solid var(--grey-200);
            position: sticky;
            top: 0
        }

        .admin-table td {
            padding: 12px 16px;
            font-size: .85rem;
            border-bottom: 1px solid var(--grey-100);
            vertical-align: middle
        }

        .admin-table tr:hover {
            background: var(--grey-50)
        }

        .admin-table .product-cell {
            display: flex;
            align-items: center;
            gap: 12px
        }

        .admin-table .product-cell img {
            width: 48px;
            height: 60px;
            object-fit: cover;
            border-radius: var(--radius-sm);
            border: 1px solid var(--grey-200)
        }

        .admin-table .product-cell .pname {
            font-weight: 600;
            font-size: .85rem
        }

        .admin-table .product-cell .pcat {
            font-size: .7rem;
            color: var(--gold-dark);
            text-transform: uppercase;
            letter-spacing: .5px
        }

        .admin-table .action-btns {
            display: flex;
            gap: 6px
        }

        .admin-table .action-btns button {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 1rem
        }

        .admin-table .action-btns .edit-btn {
            background: var(--grey-100);
            color: var(--grey-600)
        }

        .admin-table .action-btns .edit-btn:hover {
            background: var(--gold);
            color: var(--black)
        }

        .admin-table .action-btns .del-btn {
            background: var(--grey-100);
            color: var(--grey-600)
        }

        .admin-table .action-btns .del-btn:hover {
            background: var(--danger);
            color: var(--white)
        }

        .stock-badge {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: .7rem;
            font-weight: 600
        }

        .stock-badge.in {
            background: #e8f5e9;
            color: #2e7d32
        }

        .stock-badge.low {
            background: #fff8e1;
            color: #f57f17
        }

        .stock-badge.out {
            background: #fce4ec;
            color: #c62828
        }

        /* Modal / Form */
        .admin-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .5);
            z-index: 9000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px)
        }

        .admin-modal-overlay.active {
            display: flex
        }

        .admin-modal {
            background: var(--white);
            border-radius: var(--radius-md);
            max-width: 700px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 0;
            box-shadow: var(--shadow-xl)
        }

        .admin-modal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--grey-200);
            position: sticky;
            top: 0;
            background: var(--white);
            z-index: 1
        }

        .admin-modal .modal-header h2 {
            font-size: 1.2rem
        }

        .admin-modal .modal-header button {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition)
        }

        .admin-modal .modal-header button:hover {
            background: var(--grey-100)
        }

        .admin-modal .modal-body {
            padding: 24px
        }

        .admin-modal .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--grey-200);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: var(--grey-50)
        }

        .admin-form .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px
        }

        .admin-form .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px
        }

        .admin-form .form-group {
            margin-bottom: 16px
        }

        .admin-form .form-group label {
            display: block;
            font-size: .78rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .5px;
            color: var(--grey-600);
            margin-bottom: 6px
        }

        .admin-form .form-group input,
        .admin-form .form-group select,
        .admin-form .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--grey-200);
            border-radius: var(--radius-sm);
            font-size: .85rem;
            transition: var(--transition)
        }

        .admin-form .form-group input:focus,
        .admin-form .form-group select:focus,
        .admin-form .form-group textarea:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(201, 168, 76, .12)
        }

        .admin-form .form-group textarea {
            resize: vertical;
            min-height: 80px
        }

        .admin-form .form-group .hint {
            font-size: .7rem;
            color: var(--grey-400);
            margin-top: 4px
        }

        /* Price editor */
        .price-edit-input {
            width: 90px;
            padding: 6px 10px;
            border: 1px solid var(--grey-200);
            border-radius: var(--radius-sm);
            font-size: .85rem;
            font-weight: 600;
            text-align: right
        }

        .price-edit-input:focus {
            border-color: var(--gold);
            outline: none;
            box-shadow: 0 0 0 3px rgba(201, 168, 76, .12)
        }

        .bulk-bar {
            background: var(--white);
            border: 1px solid var(--grey-200);
            border-radius: var(--radius-md);
            padding: 16px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap
        }

        .bulk-bar label {
            font-size: .82rem;
            font-weight: 600;
            white-space: nowrap
        }

        .bulk-bar input[type="number"] {
            width: 80px;
            padding: 8px 12px;
            border: 1px solid var(--grey-200);
            border-radius: var(--radius-sm);
            font-size: .85rem
        }

        .bulk-bar select {
            padding: 8px 12px;
            border: 1px solid var(--grey-200);
            border-radius: var(--radius-sm);
            font-size: .85rem
        }

        /* Categories card grid */
        .cat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 24px
        }

        .cat-card {
            border: 1px solid var(--grey-200);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: var(--transition)
        }

        .cat-card:hover {
            box-shadow: var(--shadow-md)
        }

        .cat-card img {
            width: 100%;
            height: 160px;
            object-fit: cover
        }

        .cat-card .cat-info {
            padding: 16px
        }

        .cat-card .cat-info h3 {
            font-size: 1rem;
            margin-bottom: 4px
        }

        .cat-card .cat-info p {
            font-size: .8rem;
            color: var(--grey-400)
        }

        .cat-card .cat-actions {
            padding: 0 16px 16px;
            display: flex;
            gap: 8px
        }

        /* Import/Export */
        .ie-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            padding: 24px
        }

        .ie-card {
            border: 2px dashed var(--grey-200);
            border-radius: var(--radius-md);
            padding: 48px 24px;
            text-align: center;
            transition: var(--transition)
        }

        .ie-card:hover {
            border-color: var(--gold);
            background: rgba(201, 168, 76, .03)
        }

        .ie-card .material-symbols-outlined {
            font-size: 3rem;
            color: var(--gold);
            margin-bottom: 16px
        }

        .ie-card h3 {
            font-size: 1.1rem;
            margin-bottom: 8px
        }

        .ie-card p {
            font-size: .85rem;
            color: var(--grey-400);
            margin-bottom: 20px
        }

        /* Page sections */
        .admin-section {
            display: none
        }

        .admin-section.active {
            display: block
        }

        /* Toast in admin */
        .admin-toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 9999
        }

        @media(max-width:768px) {
            .admin-layout {
                grid-template-columns: 1fr
            }

            .admin-sidebar {
                position: fixed;
                left: -260px;
                top: 0;
                bottom: 0;
                width: 260px;
                z-index: 1000;
                transition: var(--transition)
            }

            .admin-sidebar.open {
                left: 0
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr)
            }

            .ie-grid {
                grid-template-columns: 1fr
            }

            .admin-form .form-row,
            .admin-form .form-row-3 {
                grid-template-columns: 1fr
            }
        }
    </style>
</head>

<body class="admin-body">
    <div class="admin-layout">
        <!-- SIDEBAR -->
        <aside class="admin-sidebar">
            <div class="logo">PREMIUM<span>.</span> <small>Admin</small></div>
            <nav class="admin-nav">
                <a class="active" onclick="showSection('dashboard',this)"><span
                        class="material-symbols-outlined">dashboard</span> Dashboard</a>
                <a onclick="showSection('products',this)"><span class="material-symbols-outlined">inventory_2</span>
                    Products</a>
                <a onclick="showSection('categories',this)"><span class="material-symbols-outlined">category</span>
                    Categories</a>
                <a onclick="showSection('prices',this)"><span class="material-symbols-outlined">payments</span> Quick
                    Prices</a>
                <div class="nav-divider"></div>
                <a onclick="showSection('importexport',this)"><span class="material-symbols-outlined">swap_vert</span>
                    Import / Export</a>
                <a
                    onclick="if(confirm('Reset ALL data to defaults? This removes all admin changes.')){AdminStore.resetToDefaults();location.reload()}"><span
                        class="material-symbols-outlined">restart_alt</span> Reset to Defaults</a>
            </nav>
            <div class="store-link"><a href="index.html" target="_blank"><span class="material-symbols-outlined"
                        style="font-size:1rem">storefront</span> View Storefront</a></div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="admin-main">

            <!-- ===== DASHBOARD ===== -->
            <div id="sec-dashboard" class="admin-section active">
                <div class="admin-header">
                    <h1>Dashboard</h1>
                </div>
                <div class="stats-grid" id="statsGrid"></div>
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2>Recent Products</h2>
                    </div>
                    <div style="max-height:400px;overflow-y:auto">
                        <table class="admin-table" id="recentTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ===== PRODUCTS ===== -->
            <div id="sec-products" class="admin-section">
                <div class="admin-header">
                    <h1>Products</h1>
                    <div class="actions"><button class="btn btn-primary btn-sm" onclick="openProductModal()"><span
                                class="material-symbols-outlined" style="font-size:1rem">add</span> Add Product</button>
                    </div>
                </div>
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2 id="productCount"></h2>
                        <div class="search-box"><span class="material-symbols-outlined">search</span><input type="text"
                                id="productSearch" placeholder="Search products..." oninput="renderProducts()"></div>
                    </div>
                    <div style="max-height:calc(100vh - 280px);overflow-y:auto">
                        <table class="admin-table" id="productTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Original</th>
                                    <th>Stock</th>
                                    <th>Badge</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ===== CATEGORIES ===== -->
            <div id="sec-categories" class="admin-section">
                <div class="admin-header">
                    <h1>Categories</h1>
                    <div class="actions"><button class="btn btn-primary btn-sm" onclick="openCategoryModal()"><span
                                class="material-symbols-outlined" style="font-size:1rem">add</span> Add
                            Category</button></div>
                </div>
                <div class="admin-card">
                    <div class="admin-card-header">
                        <h2 id="catCount"></h2>
                    </div>
                    <div class="cat-grid" id="catGrid"></div>
                </div>
            </div>

            <!-- ===== QUICK PRICES ===== -->
            <div id="sec-prices" class="admin-section">
                <div class="admin-header">
                    <h1>Quick Price Editor</h1>
                    <div class="actions"><button class="btn btn-primary btn-sm" onclick="saveAllPrices()"><span
                                class="material-symbols-outlined" style="font-size:1rem">save</span> Save All
                            Prices</button></div>
                </div>
                <div class="bulk-bar">
                    <label>Bulk Discount:</label>
                    <select id="bulkCat">
                        <option value="">All Categories</option>
                    </select>
                    <input type="number" id="bulkPercent" placeholder="%" min="0" max="90">
                    <span style="font-size:.85rem;color:var(--grey-400)">% off original price</span>
                    <button class="btn btn-sm btn-secondary" onclick="applyBulkDiscount()">Apply</button>
                </div>
                <div class="admin-card">
                    <div style="max-height:calc(100vh - 280px);overflow-y:auto">
                        <table class="admin-table" id="priceTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Current Price (₹)</th>
                                    <th>Original Price (₹)</th>
                                    <th>Discount</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ===== IMPORT / EXPORT ===== -->
            <div id="sec-importexport" class="admin-section">
                <div class="admin-header">
                    <h1>Import / Export</h1>
                </div>
                <div class="ie-grid">
                    <div class="ie-card">
                        <span class="material-symbols-outlined">download</span>
                        <h3>Export Data</h3>
                        <p>Download all products and categories as a JSON file for backup or transfer.</p>
                        <button class="btn btn-primary btn-sm" onclick="exportData()">Download JSON</button>
                    </div>
                    <div class="ie-card">
                        <span class="material-symbols-outlined">upload</span>
                        <h3>Import Data</h3>
                        <p>Upload a previously exported JSON file to restore products and categories.</p>
                        <input type="file" id="importFile" accept=".json" style="display:none"
                            onchange="importData(event)">
                        <button class="btn btn-secondary btn-sm"
                            onclick="document.getElementById('importFile').click()">Upload JSON</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- PRODUCT MODAL -->
    <div class="admin-modal-overlay" id="productModalOverlay" onclick="if(event.target===this)closeProductModal()">
        <div class="admin-modal">
            <div class="modal-header">
                <h2 id="productModalTitle">Add Product</h2><button onclick="closeProductModal()"><span
                        class="material-symbols-outlined">close</span></button>
            </div>
            <div class="modal-body">
                <form class="admin-form" id="productForm" onsubmit="saveProduct(event)">
                    <input type="hidden" id="pf-id">
                    <div class="form-row">
                        <div class="form-group"><label>Product Name *</label><input type="text" id="pf-name" required>
                        </div>
                        <div class="form-group"><label>Category *</label><select id="pf-category" required></select>
                        </div>
                    </div>
                    <div class="form-row-3">
                        <div class="form-group"><label>Selling Price (₹) *</label><input type="number" id="pf-price"
                                required min="1"></div>
                        <div class="form-group"><label>Original Price (₹) *</label><input type="number"
                                id="pf-originalPrice" required min="1"></div>
                        <div class="form-group"><label>Stock *</label><input type="number" id="pf-stock" required
                                min="0"></div>
                    </div>
                    <div class="form-row-3">
                        <div class="form-group"><label>Fit</label><select id="pf-fit">
                                <option value="regular">Regular</option>
                                <option value="slim">Slim</option>
                                <option value="oversized">Oversized</option>
                            </select></div>
                        <div class="form-group"><label>Fabric</label><input type="text" id="pf-fabric"
                                placeholder="e.g. Oxford Cotton"></div>
                        <div class="form-group"><label>Sleeve</label><select id="pf-sleeve">
                                <option value="full">Full Sleeve</option>
                                <option value="half">Half Sleeve</option>
                            </select></div>
                    </div>
                    <div class="form-row-3">
                        <div class="form-group"><label>Occasion</label><select id="pf-occasion">
                                <option value="casual">Casual</option>
                                <option value="formal">Formal</option>
                                <option value="party">Party</option>
                            </select></div>
                        <div class="form-group"><label>Rating</label><input type="number" id="pf-rating" min="1" max="5"
                                step="0.1" value="4.5"></div>
                        <div class="form-group"><label>Badge</label><select id="pf-badge">
                                <option value="">None</option>
                                <option value="bestseller">Best Seller</option>
                                <option value="new">New</option>
                                <option value="limited">Limited</option>
                            </select></div>
                    </div>
                    <div class="form-group"><label>Sizes</label><input type="text" id="pf-sizes"
                            placeholder="S, M, L, XL, XXL">
                        <div class="hint">Comma-separated values</div>
                    </div>
                    <div class="form-group"><label>Colors (hex)</label><input type="text" id="pf-colors"
                            placeholder="#000000, #ffffff, #c9a84c">
                        <div class="hint">Comma-separated hex codes</div>
                    </div>
                    <div class="form-group"><label>Main Image URL *</label><input type="url" id="pf-image" required
                            placeholder="https://images.unsplash.com/..."></div>
                    <div class="form-group"><label>Additional Image URLs</label><input type="text" id="pf-images"
                            placeholder="URL1, URL2">
                        <div class="hint">Comma-separated image URLs</div>
                    </div>
                    <div class="form-group"><label>Description</label><textarea id="pf-description"
                            placeholder="Product description..."></textarea></div>
                    <div class="form-group"><label>Care Instructions</label><input type="text" id="pf-care"
                            placeholder="Machine wash cold..."></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary btn-sm" onclick="closeProductModal()">Cancel</button>
                <button class="btn btn-primary btn-sm"
                    onclick="document.getElementById('productForm').requestSubmit()">Save Product</button>
            </div>
        </div>
    </div>

    <!-- CATEGORY MODAL -->
    <div class="admin-modal-overlay" id="catModalOverlay" onclick="if(event.target===this)closeCategoryModal()">
        <div class="admin-modal" style="max-width:480px">
            <div class="modal-header">
                <h2 id="catModalTitle">Add Category</h2><button onclick="closeCategoryModal()"><span
                        class="material-symbols-outlined">close</span></button>
            </div>
            <div class="modal-body">
                <form class="admin-form" id="catForm" onsubmit="saveCategory(event)">
                    <input type="hidden" id="cf-origId">
                    <div class="form-group"><label>Category ID *</label><input type="text" id="cf-id" required
                            placeholder="e.g. linen">
                        <div class="hint">Lowercase, no spaces (used in URL)</div>
                    </div>
                    <div class="form-group"><label>Display Name *</label><input type="text" id="cf-name" required
                            placeholder="e.g. Linen Shirts"></div>
                    <div class="form-group"><label>Icon (Material Symbol)</label><input type="text" id="cf-icon"
                            placeholder="e.g. grid_view"></div>
                    <div class="form-group"><label>Image URL</label><input type="url" id="cf-image"
                            placeholder="https://images.unsplash.com/..."></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary btn-sm" onclick="closeCategoryModal()">Cancel</button>
                <button class="btn btn-primary btn-sm" onclick="document.getElementById('catForm').requestSubmit()">Save
                    Category</button>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // ===================== NAVIGATION =====================
        function showSection(id, link) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
            document.getElementById('sec-' + id).classList.add('active');
            document.querySelectorAll('.admin-nav a').forEach(a => a.classList.remove('active'));
            if (link) link.classList.add('active');
            if (id === 'dashboard') renderDashboard();
            if (id === 'products') renderProducts();
            if (id === 'categories') renderCategories();
            if (id === 'prices') renderPrices();
        }

        // ===================== TOAST =====================
        function adminToast(msg, type = 'success') {
            let c = document.querySelector('.admin-toast');
            if (!c) { c = document.createElement('div'); c.className = 'admin-toast'; document.body.appendChild(c); }
            const t = document.createElement('div');
            t.className = 'toast ' + type;
            t.innerHTML = `<span class="material-symbols-outlined">${type === 'success' ? 'check_circle' : 'error'}</span> ${msg}`;
            c.appendChild(t);
            setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translateX(100%)'; setTimeout(() => t.remove(), 300); }, 3000);
        }

        // ===================== DASHBOARD =====================
        function renderDashboard() {
            const totalProducts = PRODUCTS.length;
            const totalCategories = CATEGORIES.length;
            const lowStock = PRODUCTS.filter(p => p.stock > 0 && p.stock <= 10).length;
            const totalValue = PRODUCTS.reduce((s, p) => s + p.price * p.stock, 0);

            document.getElementById('statsGrid').innerHTML = `
        <div class="stat-card"><div class="stat-icon blue"><span class="material-symbols-outlined">inventory_2</span></div><div class="stat-value">${totalProducts}</div><div class="stat-label">Total Products</div></div>
        <div class="stat-card"><div class="stat-icon gold"><span class="material-symbols-outlined">category</span></div><div class="stat-value">${totalCategories}</div><div class="stat-label">Categories</div></div>
        <div class="stat-card"><div class="stat-icon red"><span class="material-symbols-outlined">warning</span></div><div class="stat-value">${lowStock}</div><div class="stat-label">Low Stock</div></div>
        <div class="stat-card"><div class="stat-icon green"><span class="material-symbols-outlined">payments</span></div><div class="stat-value">₹${(totalValue / 100000).toFixed(1)}L</div><div class="stat-label">Inventory Value</div></div>`;

            const tbody = document.querySelector('#recentTable tbody');
            tbody.innerHTML = PRODUCTS.slice(0, 10).map(p => `
        <tr>
          <td><div class="product-cell"><img src="${p.image}" alt="${p.name}"><div><div class="pname">${p.name}</div></div></div></td>
          <td><span style="font-size:.75rem;text-transform:uppercase;color:var(--gold-dark);letter-spacing:.5px">${p.category}</span></td>
          <td style="font-weight:600">₹${p.price.toLocaleString('en-IN')}</td>
          <td>${stockBadge(p.stock)}</td>
        </tr>`).join('');
        }

        function stockBadge(stock) {
            if (stock <= 0) return '<span class="stock-badge out">Out of Stock</span>';
            if (stock <= 10) return `<span class="stock-badge low">${stock} left</span>`;
            return `<span class="stock-badge in">${stock} in stock</span>`;
        }

        // ===================== PRODUCTS =====================
        function renderProducts() {
            const query = (document.getElementById('productSearch')?.value || '').toLowerCase();
            let filtered = PRODUCTS;
            if (query) filtered = PRODUCTS.filter(p => p.name.toLowerCase().includes(query) || p.category.toLowerCase().includes(query));

            document.getElementById('productCount').textContent = `${filtered.length} Products`;
            const tbody = document.querySelector('#productTable tbody');
            tbody.innerHTML = filtered.map(p => `
        <tr>
          <td><div class="product-cell"><img src="${p.image}" alt="${p.name}"><div><div class="pname">${p.name}</div><div class="pcat">${p.category}</div></div></div></td>
          <td><span style="font-size:.75rem;text-transform:uppercase;letter-spacing:.5px">${p.category}</span></td>
          <td style="font-weight:700">₹${p.price.toLocaleString('en-IN')}</td>
          <td style="color:var(--grey-400);text-decoration:line-through;font-size:.8rem">₹${p.originalPrice.toLocaleString('en-IN')}</td>
          <td>${stockBadge(p.stock)}</td>
          <td>${p.badge ? `<span class="badge ${p.badge === 'bestseller' ? 'badge-gold' : p.badge === 'new' ? 'badge-black' : 'badge-danger'}">${p.badge}</span>` : '—'}</td>
          <td><div class="action-btns">
            <button class="edit-btn" onclick="editProduct(${p.id})" title="Edit"><span class="material-symbols-outlined">edit</span></button>
            <button class="del-btn" onclick="deleteProduct(${p.id})" title="Delete"><span class="material-symbols-outlined">delete</span></button>
          </div></td>
        </tr>`).join('');
        }

        function openProductModal(product) {
            document.getElementById('productModalTitle').textContent = product ? 'Edit Product' : 'Add Product';
            const catSelect = document.getElementById('pf-category');
            catSelect.innerHTML = CATEGORIES.map(c => `<option value="${c.id}">${c.name}</option>`).join('');

            if (product) {
                document.getElementById('pf-id').value = product.id;
                document.getElementById('pf-name').value = product.name;
                catSelect.value = product.category;
                document.getElementById('pf-price').value = product.price;
                document.getElementById('pf-originalPrice').value = product.originalPrice;
                document.getElementById('pf-stock').value = product.stock;
                document.getElementById('pf-fit').value = product.fit || 'regular';
                document.getElementById('pf-fabric').value = product.fabric || '';
                document.getElementById('pf-sleeve').value = product.sleeve || 'full';
                document.getElementById('pf-occasion').value = product.occasion || 'casual';
                document.getElementById('pf-rating').value = product.rating || 4.5;
                document.getElementById('pf-badge').value = product.badge || '';
                document.getElementById('pf-sizes').value = (product.sizes || []).join(', ');
                document.getElementById('pf-colors').value = (product.colors || []).join(', ');
                document.getElementById('pf-image').value = product.image || '';
                document.getElementById('pf-images').value = (product.images || []).join(', ');
                document.getElementById('pf-description').value = product.description || '';
                document.getElementById('pf-care').value = product.care || '';
            } else {
                document.getElementById('productForm').reset();
                document.getElementById('pf-id').value = '';
                document.getElementById('pf-rating').value = '4.5';
            }
            document.getElementById('productModalOverlay').classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('productModalOverlay').classList.remove('active');
        }

        function editProduct(id) {
            const p = PRODUCTS.find(x => x.id === id);
            if (p) openProductModal(p);
        }

        function deleteProduct(id) {
            const p = PRODUCTS.find(x => x.id === id);
            if (!p) return;
            if (!confirm(`Delete "${p.name}"? This cannot be undone.`)) return;
            PRODUCTS = PRODUCTS.filter(x => x.id !== id);
            AdminStore.saveProducts();
            renderProducts();
            adminToast('Product deleted');
        }

        function saveProduct(e) {
            e.preventDefault();
            const id = document.getElementById('pf-id').value;
            const productData = {
                id: id ? parseInt(id) : AdminStore.getNextProductId(),
                name: document.getElementById('pf-name').value.trim(),
                category: document.getElementById('pf-category').value,
                price: parseInt(document.getElementById('pf-price').value),
                originalPrice: parseInt(document.getElementById('pf-originalPrice').value),
                stock: parseInt(document.getElementById('pf-stock').value),
                fit: document.getElementById('pf-fit').value,
                fabric: document.getElementById('pf-fabric').value.trim(),
                sleeve: document.getElementById('pf-sleeve').value,
                occasion: document.getElementById('pf-occasion').value,
                rating: parseFloat(document.getElementById('pf-rating').value) || 4.5,
                reviews: id ? (PRODUCTS.find(p => p.id === parseInt(id))?.reviews || 0) : 0,
                badge: document.getElementById('pf-badge').value,
                sizes: document.getElementById('pf-sizes').value.split(',').map(s => s.trim()).filter(Boolean),
                colors: document.getElementById('pf-colors').value.split(',').map(s => s.trim()).filter(Boolean),
                image: document.getElementById('pf-image').value.trim(),
                images: document.getElementById('pf-images').value ? document.getElementById('pf-images').value.split(',').map(s => s.trim()).filter(Boolean) : [document.getElementById('pf-image').value.trim()],
                description: document.getElementById('pf-description').value.trim(),
                care: document.getElementById('pf-care').value.trim()
            };

            if (id) {
                const idx = PRODUCTS.findIndex(p => p.id === parseInt(id));
                if (idx > -1) PRODUCTS[idx] = productData;
            } else {
                PRODUCTS.push(productData);
            }

            AdminStore.saveProducts();
            closeProductModal();
            renderProducts();
            adminToast(id ? 'Product updated' : 'Product added');
        }

        // ===================== CATEGORIES =====================
        function renderCategories() {
            document.getElementById('catCount').textContent = `${CATEGORIES.length} Categories`;
            document.getElementById('catGrid').innerHTML = CATEGORIES.map(c => {
                const count = PRODUCTS.filter(p => p.category === c.id).length;
                return `
          <div class="cat-card">
            <img src="${c.image || 'https://via.placeholder.com/400x200?text=' + c.name}" alt="${c.name}">
            <div class="cat-info">
              <h3>${c.name}</h3>
              <p>${count} product${count !== 1 ? 's' : ''} · ID: ${c.id}</p>
            </div>
            <div class="cat-actions">
              <button class="btn btn-sm btn-secondary" onclick="editCategory('${c.id}')"><span class="material-symbols-outlined" style="font-size:.9rem">edit</span> Edit</button>
              <button class="btn btn-sm btn-secondary" onclick="deleteCategory('${c.id}')" style="color:var(--danger)"><span class="material-symbols-outlined" style="font-size:.9rem">delete</span> Delete</button>
            </div>
          </div>`;
            }).join('');
        }

        function openCategoryModal(cat) {
            document.getElementById('catModalTitle').textContent = cat ? 'Edit Category' : 'Add Category';
            if (cat) {
                document.getElementById('cf-origId').value = cat.id;
                document.getElementById('cf-id').value = cat.id;
                document.getElementById('cf-name').value = cat.name;
                document.getElementById('cf-icon').value = cat.icon || '';
                document.getElementById('cf-image').value = cat.image || '';
            } else {
                document.getElementById('catForm').reset();
                document.getElementById('cf-origId').value = '';
            }
            document.getElementById('catModalOverlay').classList.add('active');
        }

        function closeCategoryModal() {
            document.getElementById('catModalOverlay').classList.remove('active');
        }

        function editCategory(id) {
            const c = CATEGORIES.find(x => x.id === id);
            if (c) openCategoryModal(c);
        }

        function deleteCategory(id) {
            const count = PRODUCTS.filter(p => p.category === id).length;
            const msg = count > 0 ? `This category has ${count} product(s). Delete anyway?` : 'Delete this category?';
            if (!confirm(msg)) return;
            CATEGORIES = CATEGORIES.filter(c => c.id !== id);
            AdminStore.saveCategories();
            renderCategories();
            adminToast('Category deleted');
        }

        function saveCategory(e) {
            e.preventDefault();
            const origId = document.getElementById('cf-origId').value;
            const catData = {
                id: document.getElementById('cf-id').value.trim().toLowerCase().replace(/\s+/g, '-'),
                name: document.getElementById('cf-name').value.trim(),
                icon: document.getElementById('cf-icon').value.trim() || 'category',
                image: document.getElementById('cf-image').value.trim()
            };

            if (origId) {
                const idx = CATEGORIES.findIndex(c => c.id === origId);
                if (idx > -1) {
                    CATEGORIES[idx] = catData;
                    // Update product categories if ID changed
                    if (origId !== catData.id) {
                        PRODUCTS.forEach(p => { if (p.category === origId) p.category = catData.id; });
                        AdminStore.saveProducts();
                    }
                }
            } else {
                if (CATEGORIES.find(c => c.id === catData.id)) {
                    adminToast('Category ID already exists', 'error');
                    return;
                }
                CATEGORIES.push(catData);
            }

            AdminStore.saveCategories();
            closeCategoryModal();
            renderCategories();
            adminToast(origId ? 'Category updated' : 'Category added');
        }

        // ===================== QUICK PRICES =====================
        function renderPrices() {
            // Fill category filter
            const bulkCat = document.getElementById('bulkCat');
            const currentVal = bulkCat.value;
            bulkCat.innerHTML = '<option value="">All Categories</option>' + CATEGORIES.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            bulkCat.value = currentVal;

            const tbody = document.querySelector('#priceTable tbody');
            tbody.innerHTML = PRODUCTS.map(p => {
                const disc = Math.round(((p.originalPrice - p.price) / p.originalPrice) * 100);
                return `<tr>
          <td><div class="product-cell"><img src="${p.image}" alt="${p.name}"><div><div class="pname">${p.name}</div></div></div></td>
          <td style="font-size:.75rem;text-transform:uppercase;letter-spacing:.5px">${p.category}</td>
          <td><input class="price-edit-input" type="number" data-id="${p.id}" data-field="price" value="${p.price}" min="1"></td>
          <td><input class="price-edit-input" type="number" data-id="${p.id}" data-field="originalPrice" value="${p.originalPrice}" min="1"></td>
          <td><span style="font-weight:600;color:${disc > 0 ? 'var(--success)' : 'var(--grey-400)'}">${disc}% off</span></td>
        </tr>`;
            }).join('');
        }

        function saveAllPrices() {
            document.querySelectorAll('.price-edit-input').forEach(input => {
                const id = parseInt(input.dataset.id);
                const field = input.dataset.field;
                const value = parseInt(input.value);
                const p = PRODUCTS.find(x => x.id === id);
                if (p && value > 0) p[field] = value;
            });
            AdminStore.saveProducts();
            renderPrices();
            adminToast('All prices saved');
        }

        function applyBulkDiscount() {
            const cat = document.getElementById('bulkCat').value;
            const pct = parseInt(document.getElementById('bulkPercent').value);
            if (!pct || pct <= 0 || pct > 90) { adminToast('Enter a valid discount %', 'error'); return; }
            let count = 0;
            PRODUCTS.forEach(p => {
                if (!cat || p.category === cat) {
                    p.price = Math.round(p.originalPrice * (1 - pct / 100));
                    count++;
                }
            });
            AdminStore.saveProducts();
            renderPrices();
            adminToast(`${pct}% discount applied to ${count} products`);
        }

        // ===================== IMPORT / EXPORT =====================
        function exportData() {
            const json = AdminStore.exportData();
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'premium-store-data.json';
            a.click();
            URL.revokeObjectURL(url);
            adminToast('Data exported successfully');
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (ev) {
                try {
                    AdminStore.importData(ev.target.result);
                    adminToast('Data imported successfully! Reloading...');
                    setTimeout(() => location.reload(), 1000);
                } catch (err) {
                    adminToast('Invalid JSON file', 'error');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        // ===================== INIT =====================
        renderDashboard();
    </script>
</body>

</html>