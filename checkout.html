<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout — PREMIUM.</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="navbar"></div>
    <div class="checkout-page">
        <div class="container">
            <div class="breadcrumb"><a href="index.html">Home</a><span class="sep">/</span><a
                    href="cart.html">Cart</a><span class="sep">/</span><span class="current">Checkout</span></div>
            <h1 style="font-size:2rem;margin-bottom:32px">Checkout</h1>
            <div class="checkout-layout">
                <div>
                    <div class="checkout-section">
                        <h2>Shipping Address</h2>
                        <form id="checkoutForm" onsubmit="placeOrder(event)">
                            <div class="form-row">
                                <div class="form-group"><label>First Name</label><input type="text" id="shipFirstName"
                                        required placeholder="John"></div>
                                <div class="form-group"><label>Last Name</label><input type="text" id="shipLastName"
                                        required placeholder="Doe"></div>
                            </div>
                            <div class="form-group"><label>Email</label><input type="email" id="shipEmail" required
                                    placeholder="john@example.com"></div>
                            <div class="form-group"><label>Phone</label><input type="tel" id="shipPhone" required
                                    placeholder="+91 9876543210"></div>
                            <div class="form-group"><label>Address</label><input type="text" id="shipAddress" required
                                    placeholder="Street address, apartment, floor"></div>
                            <div class="form-row">
                                <div class="form-group"><label>City</label><input type="text" id="shipCity" required
                                        placeholder="Mumbai"></div>
                                <div class="form-group"><label>State</label><select id="shipState" required>
                                        <option value="">Select State</option>
                                        <option>Maharashtra</option>
                                        <option>Delhi</option>
                                        <option>Karnataka</option>
                                        <option>Tamil Nadu</option>
                                        <option>Gujarat</option>
                                        <option>Telangana</option>
                                        <option>Rajasthan</option>
                                        <option>Other</option>
                                    </select></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Pincode</label><input type="text" id="shipPincode"
                                        required maxlength="6" placeholder="400001"></div>
                                <div class="form-group"><label>Country</label><input type="text" value="India" readonly>
                                </div>
                            </div>
                    </div>
                    <div class="checkout-section">
                        <h2>Payment Method</h2>
                        <div class="payment-options">
                            <label class="payment-option active"><input type="radio" name="payment" value="cod" checked
                                    onchange="this.closest('.payment-options').querySelectorAll('.payment-option').forEach(o=>o.classList.remove('active'));this.closest('.payment-option').classList.add('active')">
                                <span class="material-symbols-outlined">local_shipping</span>
                                <div><strong>Cash on Delivery</strong>
                                    <div style="font-size:.8rem;color:var(--grey-400)">Pay when your order arrives</div>
                                </div>
                            </label>
                            <label class="payment-option"><input type="radio" name="payment" value="card"
                                    onchange="this.closest('.payment-options').querySelectorAll('.payment-option').forEach(o=>o.classList.remove('active'));this.closest('.payment-option').classList.add('active')">
                                <span class="material-symbols-outlined">credit_card</span>
                                <div><strong>Credit / Debit Card</strong>
                                    <div style="font-size:.8rem;color:var(--grey-400)">Visa, Mastercard, RuPay</div>
                                </div>
                            </label>
                            <label class="payment-option"><input type="radio" name="payment" value="upi"
                                    onchange="this.closest('.payment-options').querySelectorAll('.payment-option').forEach(o=>o.classList.remove('active'));this.closest('.payment-option').classList.add('active')">
                                <span class="material-symbols-outlined">account_balance</span>
                                <div><strong>UPI</strong>
                                    <div style="font-size:.8rem;color:var(--grey-400)">Google Pay, PhonePe, Paytm</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-gold btn-lg" style="width:100%">Place Order</button>
                    </form>
                </div>
                <div class="cart-summary" id="orderSummary"></div>
            </div>
        </div>
    </div>
    <div id="footer"></div>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="data.js"></script>
    <script src="app.js"></script>
    <script>
        document.getElementById('navbar').innerHTML = getNavbarHTML();
        document.getElementById('footer').innerHTML = getFooterHTML();
        initApp();

        function renderSummary() {
            const cart = Store.getCart();
            if (cart.length === 0) { window.location.href = 'cart.html'; return; }
            const subtotal = Store.getCartTotal();
            const shipping = subtotal >= 500 ? 0 : 50;
            document.getElementById('orderSummary').innerHTML = `
        <h3>Order Summary</h3>
        ${cart.map(item => {
                const p = getProduct(item.productId);
                return p ? `<div style="display:flex;gap:12px;margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--grey-200)"><img src="${p.image}" alt="${p.name}" style="width:60px;height:75px;object-fit:cover;border-radius:var(--radius-sm)"><div><div style="font-size:.85rem;font-weight:500">${p.name}</div><div style="font-size:.75rem;color:var(--grey-400)">Size: ${item.size} × ${item.qty}</div><div style="font-weight:600">${formatPrice(p.price * item.qty)}</div></div></div>` : '';
            }).join('')}
        <div class="summary-row"><span>Subtotal</span><span>${formatPrice(subtotal)}</span></div>
        <div class="summary-row"><span>Shipping</span><span>${shipping === 0 ? '<span style="color:var(--success)">FREE</span>' : formatPrice(shipping)}</span></div>
        <div class="summary-row total"><span>Total</span><span>${formatPrice(subtotal + shipping)}</span></div>
      `;
        }

        function placeOrder(e) {
            e.preventDefault();
            const orderId = generateOrderId();
            const cart = Store.getCart();
            const subtotal = Store.getCartTotal();
            const shipping = subtotal >= 500 ? 0 : 50;
            const payment = document.querySelector('input[name="payment"]:checked').value;

            const order = {
                id: orderId,
                items: cart.map(item => ({ ...item, product: getProduct(item.productId) })),
                subtotal: subtotal,
                shipping: shipping,
                total: subtotal + shipping,
                payment: payment,
                address: {
                    firstName: document.getElementById('shipFirstName').value,
                    lastName: document.getElementById('shipLastName').value,
                    email: document.getElementById('shipEmail').value,
                    phone: document.getElementById('shipPhone').value,
                    street: document.getElementById('shipAddress').value,
                    city: document.getElementById('shipCity').value,
                    state: document.getElementById('shipState').value,
                    pincode: document.getElementById('shipPincode').value,
                    country: 'India'
                },
                date: new Date().toISOString(),
                status: 'confirmed'
            };
            Store.addOrder(order);
            Store.clearCart();
            document.querySelector('.checkout-layout').innerHTML = `
        <div class="empty-state" style="grid-column:1/-1">
          <span class="material-symbols-outlined" style="font-size:4rem;color:var(--success);margin-bottom:16px">check_circle</span>
          <h2>Order Placed Successfully!</h2>
          <p style="margin-bottom:8px">Your order ID is <strong>${orderId}</strong></p>
          <p style="color:var(--grey-400);margin-bottom:32px">We'll send you a confirmation email shortly.</p>
          <div style="display:flex;gap:16px;justify-content:center;flex-wrap:wrap">
            <a href="orders.html" class="btn btn-primary">View My Orders</a>
            <a href="category.html" class="btn btn-secondary">Continue Shopping</a>
          </div>
        </div>`;
        }

        renderSummary();
    </script>
</body>

</html>